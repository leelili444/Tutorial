---
description: Sensor configuration
---
# Orientation and Coordinate Frame of IMU

## General Rules to Determin IMU Axies Direction

The positive direction for the angular velocity (rate of rotation) about any IMU axis (X, Y, or Z) is universally defined by the **Right-Hand Rule (RHR)**.

1.  **Application of the RHR:**
    * **Curl** the fingers of your right hand in the direction of the rotation.
    * **Extend** your right thumb.

2.  **Determining the Positive Direction:**
    * If the extended thumb points along the **positive direction of the axis** (e.g., in the +X, +Y, or +Z direction), the rotation is considered **Positive (+)**.

3.  **Determining the Negative Direction:**
    * If the extended thumb points along the **negative direction of the axis** (e.g., in the -X, -Y, or -Z direction), the rotation is considered **Negative (-)**.

On the other hand, curl the four fingers of the right hand in the direction of rotation, and the thumb points in the positive direction of that axis.

## Orientation of ICM42688-P
![Coordinate frame of IMU](image/sensor-configuration/1760421288886.png)

This definition explicitly links the IMU's internal coordinate axes to the physical reference mark on the package, as typically illustrated in the chip's datasheet as shown in the above figure:

1.  **Reference Mark Location:**
    * The chip package has a **small indentation or dimple** located near the **top-left corner**. This mark serves as the **Pin 1 Indicator** and the primary point of reference for the axis definition.

2.  **Defining the X-Axis (Right):**
    * The **$+X$ axis** is defined as running **parallel to the chip's plane**, starting from the marked side and pointing to the **right side** of the package.

3.  **Defining the Z-Axis (Up):**
    * The **$+Z$ axis** is defined as pointing **vertically upward**, perpendicular to the surface of the chip package. (This is the standard convention for MEMS sensors, where a stationary chip reports $\text{+1g}$ on the $\text{Z}$-axis).

4.  **Defining the Y-Axis (Forward/External) via the Right-Hand Rule (RHR):**
    * Following the **Right-Hand Rule**: Given the directions of $+X$ (Right) and $+Z$ (Up), the **$+Y$ axis** is determined to point **forward/outward**.
    * **Specifically:** The $+Y$ axis is perpendicular to the $X$ axis and points **away from the chip** across the marked edge (the "front" side defined by the dimple's location).

***

## Summary of ICM42688P's orientation:

| Axis | Physical Direction | RHR Standard |
| :---: | :---: | :---: |
| **$+X$** | Right | Points right along the chip plane. |
| **$+Y$** | Forward / Outward | Points away from the chip, perpendicular to the marked edge. |
| **$+Z$** | Vertically Upward | Perpendicular to the chip surface (out of the page). |

# Selection of Full-scale Range 
## General Principles 

The setting of the Inertial Measurement Unit (IMU) Full-Scale Range (FSR) is a critical engineering decision that balances **Measurement Range (to prevent saturation)** and **Measurement Precision (to maximize resolution)**.

The core objective when setting the FSR is to select the **smallest possible range** that is **guaranteed to be greater than** the maximum expected measurement in the application.

* **Gyroscope Range (DPS) Setting:**
    * Select the **smallest available FSR** that is **at least 10-20% higher** than the **maximum angular rate** generated by the platform during its most intense maneuvers (e.g., emergency evasion or aerobatics).
    * **Reasoning:** A smaller range results in a higher digital **sensitivity** (LSB/DPS), which improves the accuracy of detecting small motions and reduces quantization noise.

* **Accelerometer Range (g) Setting:**
    * The FSR must cover the sum of **gravity**, **maximum dynamic maneuver acceleration**, and **environmental vibration peaks** across all axes.
    * **Reasoning:** Insufficient range leads to sensor output **saturation (clipping)**, causing the flight control system to receive distorted or unusable data, severely compromising attitude estimation and stability.

## ICM-42688-P Specification and Accelerometer Range Setting Analysis 

### Sensor Specifications of Micropilot MP2128HELI3 UAV Autopilot
The easier way to configure the range is to take a comercial product on the market as a reference.  For example, We will analyze the setting of the ICM-42688-P's ranges by referencing the high-performance requirements of a UAV autopilot like the **Micropilot MP2128HELI3 UAV Autopilot** (Max Rate: 450 DPS, Max Accel: 32g).
![Sensor speicifications of Micropilot MP2128HELI3](image/sensor-configuration/1760425595930.png)  

The need for 32g or higher ranges in high-performance UAVs is generally for measuring **high-frequency, high-G vibration peaks** and instantaneous acceleration during non-damaging **hard landings** or **severe turbulence**. The sensor must be able to measure and filter these momentary peaks.


### Accelerometer range for ICM42688P 

The ICM-42688-P provides the following user-selectable FSR options: Gyroscope FSRs from 15.625 to 2000 DPS, and Accelerometer FSRs of 2g to 16g.

- For **UAVs, robots, or general attitude estimation systems (AHRS, INS, SLAM)**,  
a range of **±4 g** is recommended, as normal flight or motion rarely exceeds 2 g.  

- For **high-dynamic applications**, such as fixed-wing aircraft or fast-moving vehicles with sharp acceleration,  we can choose **±8 g**.  

- For **systems involving impacts or collisions**, such as landing detection or mechanical contact,  select **±16 g** to prevent signal saturation.  

- For **static orientation or vibration sensing** applications,  
**±2 g** may be used to achieve the highest sensitivity and lowest noise.  



**Range Selection Outcomes:**

* **Gyroscope Selection:** I would select the smallest available FSR that exceeds the Micropilot's maximum angular rate, which is **500 DPS** . This setting is deemed **suitable** as it optimizes resolution while covering the necessary dynamic range.
* **Accelerometer Selection:** In attitude estimation or inertial navigation systems, where the goal is accurate motion tracking and stable control, **±4 g** is generally the most practical default setting. This range provides:
  - Enough headroom for mild dynamic motion  
  - High resolution for smooth attitude estimation  
  - Low noise for stable filtering performance  
  
# Data Reading Modes for ICM42688P

The ICM42688P supports three main data reading modes: **Register Mode**, **Interrupt Mode**, and **FIFO Mode**. Each offers distinct advantages in terms of real-time performance, host workload, and application suitability. Developers should select the appropriate mode according to system requirements and task characteristics.

---

## Register Mode

In **Register Mode**, the host periodically polls the IMU’s data registers to read the latest accelerometer and gyroscope values. Each read operation retrieves the most recently produced data from the sensor.

The main advantage of this mode is **minimal latency** and **maximum real-time performance**. Since the host reads the data immediately after each update, it ensures precise timing synchronization—ideal for high-frequency control systems such as flight control loops or motor torque feedback.  
The drawback is that the host must continuously access the IMU registers, which increases MCU load and bus usage. If polling is not performed frequently enough, data may be overwritten, leading to data loss.

Typical applications include:
- Flight control system attitude stabilization  
- Motor servo control and force feedback systems  
- High-frequency dynamic response testing equipment  

---

## Interrupt Mode

**Interrupt Mode** provides a balance between real-time performance and system efficiency. The ICM42688P offers multiple interrupt sources (e.g., `DATA_RDY`, `FIFO_THS`, `FIFO_FULL`), with **Data Ready interrupt (DATA_RDY)** being the most commonly used.  
When new sensor data is available, the IMU generates a pulse on the interrupt pin, allowing the host MCU to read the latest data immediately in the interrupt service routine.

Compared with pure polling, this mode greatly reduces unnecessary CPU waiting time while maintaining high responsiveness. The MCU receives new samples almost instantly upon generation, ensuring data timing consistency and system responsiveness.

**Key advantages include:**
- Very low latency (typically <1 ms)  
- Lower MCU load compared to polling  
- Compatible with DMA for high-efficiency data acquisition  

**Typical applications:**
- Flight attitude estimation and control loops  
- Robot sensor fusion (IMU + encoders)  
- Real-time data monitoring systems  

---

## FIFO Mode

In **FIFO Mode**, the ICM42688P automatically stores sensor outputs into its internal FIFO buffer. The host can periodically read batches of samples either on schedule or when a FIFO threshold interrupt is triggered.  
This mode significantly reduces communication frequency between the host and the IMU, preventing packet loss and ensuring continuous data collection.

The main advantage of FIFO Mode is **reduced host workload and improved data integrity**. Even if the MCU is temporarily busy, no data is immediately lost.  
However, since each sample waits in the buffer before being read, this mode introduces some latency. The delay depends on both the host’s reading frequency and the configured FIFO watermark. If the read interval is too long or the FIFO depth too large, data latency increases noticeably.

**Typical applications:**
- Inertial Navigation Systems (INS / AHRS)  
- Robot attitude estimation and visual-inertial fusion (VIO / VINS)  
- Data logging, performance testing, and offline analysis  

---

# Wrap up
Considering the scenario of attitude estimation and control for general mobile robots, we will make the following configurations in MX Motion IMU project:
* Use **Interrupt Mode** and **DMA** to achieve hight real-time performance up to 1kHz.
* Set full scale range of gyroscope to 500 DPS
* Set full scale range of accelerometer to 4g.
* Set the IMU to low-noise mode.

